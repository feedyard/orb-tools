# src/jobs/lint.yaml

description: Lint an orb with yamllint

executor: circleci-orb-agent

parameters:

  use-default-rules:
    description: >
      Use default orb YAML linting rules (extends: relaxed,
      max line-length: 200, allow-non-breakable-inline-mappings: true).
      If set to false, you must set use-custom-rules to true and supply
      a filepath to the custom-rules-filepath parameter.
    type: boolean
    default: false

  lint-dir:
    description: >
      Directory within which to lint all YAML files,
      defaults to the working directory (.)
    type: string
    default: .

  custom-rules-filepath:
    description: >
      Location of your custom yamllint configuration file,
      defaults to .yamllint in the working directory
    type: string
    default: .yamllint

steps:
  - checkout
  - when:
      condition: <<parameters.use-default-rules>>
      steps:
        - run:
            name: output default .yamllint file in the working directory
            command: |
              touch .yamllint || true
              cat \<< EOF > .yamllint
              extends: relaxed
              rules:
                line-length:
                  max: 200
                  allow-non-breakable-inline-mappings: true
              EOF
        - run:
            name: yamllint
            command: yamllint <<parameters.lint-dir>>
  - unless:
      condition: <<parameters.use-default-rules>>
      steps:
        - run: yamllint -c <<parameters.custom-rules-filepath>> <<parameters.lint-dir>>
